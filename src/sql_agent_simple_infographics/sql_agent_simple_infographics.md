# SQL Agent with μΈν¬κ·Έλν”½ μ‹μ¤ν…

## κ°μ”

μ΄ μ‹μ¤ν…μ€ **SQL Agentμ™€ μΈν¬κ·Έλν”½ μƒμ„±μ„ κ²°ν•©ν• λ€ν™”ν• λ°μ΄ν„° λ¶„μ„ λ„κµ¬**μ…λ‹λ‹¤. μ‚¬μ©μκ°€ μμ—°μ–΄λ΅ μ§λ¬Έν•λ©΄ μλ™μΌλ΅ SQL μΏΌλ¦¬λ¥Ό μƒμ„±ν•κ³  μ‹¤ν–‰ν• ν›„, κ²°κ³Όλ¥Ό μ‹κ°ν™”ν•  μ μμµλ‹λ‹¤.

## ν•µμ‹¬ κµ¬μ„± μ”μ†

### 1. ν™κ²½ μ„¤μ •

- **LLM**: Google Gemini 2.5 Flash λ¨λΈ μ‚¬μ©
- **λ°μ΄ν„°λ² μ΄μ¤**: MySQL μ—°κ²° (ν™κ²½λ³€μμ—μ„ DB μ •λ³΄ λ΅λ“)
- **Agent**: LangChainμ SQL Agent μƒμ„±
- **μ‹κ°ν™”**: Plotlyλ¥Ό μ‚¬μ©ν• μΈν„°λ™ν‹°λΈ μ°¨νΈ

### 2. μ£Όμ” λΌμ΄λΈλ¬λ¦¬

```python
- langchain_community: SQL Agent λ° λ°μ΄ν„°λ² μ΄μ¤ μ ν‹Έλ¦¬ν‹°
- langchain_google_genai: Google Gemini LLM
- plotly: μΈν„°λ™ν‹°λΈ μ°¨νΈ μƒμ„±
- pandas: λ°μ΄ν„° μ²λ¦¬
- pymysql: MySQL μ—°κ²°
```

## μ£Όμ” ν•¨μ μ„¤λ…

### `create_infographic_from_sql_query(sql_query, question)`

SQL μΏΌλ¦¬ κ²°κ³Όλ¥Ό μ‹κ°ν™”ν•λ” ν•µμ‹¬ ν•¨μ

**κΈ°λ¥:**

- SQL μΏΌλ¦¬λ¥Ό μ§μ ‘ μ‹¤ν–‰ν•κ³  κ²°κ³Όλ¥Ό DataFrameμΌλ΅ λ³€ν™
- Decimal κ°μ²΄ μ²λ¦¬λ¥Ό μ„ν• λ³µμ΅ν• νμ‹± λ΅μ§ κµ¬ν„
- λ°μ΄ν„° νƒ€μ…μ— λ”°λΌ μλ™μΌλ΅ μ μ ν• μ°¨νΈ μ„ νƒ
- HTML νμΌλ΅ μΈν¬κ·Έλν”½ μ €μ¥

**μ°¨νΈ μ„ νƒ λ΅μ§:**

- **λ§‰λ€ μ°¨νΈ**: μ«μ μ»¬λΌ + μΉ΄ν…κ³ λ¦¬ μ»¬λΌμ΄ μλ” κ²½μ°
- **νμ΄ μ°¨νΈ**: μΉ΄ν…κ³ λ¦¬ λ°μ΄ν„°λ§ μλ” κ²½μ°
- **ν…μ΄λΈ”**: κΈ°νƒ€ λ¨λ“  κ²½μ°

### `extract_sql_from_agent_output(captured_text)`

Agent μ‹¤ν–‰ λ΅κ·Έμ—μ„ SQL μΏΌλ¦¬λ¥Ό μ¶”μ¶ν•λ” ν•¨μ

**κΈ°λ¥:**

- μ •κ·μ‹ ν¨ν„΄μ„ μ‚¬μ©ν•΄ μ‹¤ν–‰λ SQL μΏΌλ¦¬ μ°ΎκΈ°
- SELECT λ¬Έλ§ ν•„ν„°λ§ν•μ—¬ λ°ν™
- μ—¬λ¬ ν¨ν„΄μ„ μ‹λ„ν•μ—¬ μ•μ •μ μΈ μ¶”μ¶

## μ‹μ¤ν… μ‘λ™ λ°©μ‹

### 1. μ§λ¬Έ μ…λ ¥

```
β“ μ§λ¬Έμ„ μ…λ ¥ν•μ„Έμ”: κ° μΉ΄ν…κ³ λ¦¬λ³„ μν™” μλ¥Ό μ•λ ¤μ£Όμ„Έμ”
```

### 2. SQL Agent μ‹¤ν–‰

- μμ—°μ–΄ μ§λ¬Έμ„ SQL μΏΌλ¦¬λ΅ λ³€ν™
- λ°μ΄ν„°λ² μ΄μ¤μ—μ„ μΏΌλ¦¬ μ‹¤ν–‰
- κ²°κ³Όλ¥Ό μμ—°μ–΄λ΅ μ„¤λ…

### 3. κ²°κ³Ό μ¶λ ¥

```
β… λ‹µλ³€:
μΉ΄ν…κ³ λ¦¬λ³„ μν™” μλ” λ‹¤μκ³Ό κ°™μµλ‹λ‹¤:
- Action: 64νΈ
- Comedy: 58νΈ
- Drama: 62νΈ
...
```

### 4. μΈν¬κ·Έλν”½ μƒμ„± (μ„ νƒμ‚¬ν•­)

```
π¨ μΈν¬κ·Έλν”½μ„ μƒμ„±ν•μ‹κ² μµλ‹κΉ? (y/n): y
```

### 5. HTML νμΌ μƒμ„±

- `infographics/` ν΄λ”μ— νƒ€μ„μ¤νƒ¬ν”„κ°€ ν¬ν•¨λ νμΌλ…μΌλ΅ μ €μ¥
- λΈλΌμ°μ €μ—μ„ λ°”λ΅ μ—΄μ–΄λ³Ό μ μλ” μΈν„°λ™ν‹°λΈ μ°¨νΈ

## λ°μ΄ν„° μ²λ¦¬ νΉμ§•

### Decimal κ°μ²΄ μ²λ¦¬

MySQLμ—μ„ λ°ν™λλ” Decimal κ°μ²΄λ¥Ό μ•μ „ν•κ² νμ‹±:

```python
# Decimal('123.45') β†’ 123.45
def decimal_replacer(match):
    return match.group(1)

cleaned_result = re.sub(r"Decimal\('([^']+)'\)", decimal_replacer, result)
```

### λ‹¤μ–‘ν• λ°μ΄ν„° ν•νƒ μ§€μ›

- νν” λ¦¬μ¤νΈ: `[('name1', 'name2', value), ...]`
- λ¬Έμμ—΄ κ²°κ³Ό: Agent μ¶λ ¥μ„ νμ‹±
- μ •κ·μ‹ λ€μ• νμ‹±: λ³µμ΅ν• ν•νƒλ„ μ²λ¦¬

### μλ™ μ»¬λΌλ… μƒμ„±

```python
if num_cols == 2:
    columns = ['name', 'value']
elif num_cols == 3:
    columns = ['col1', 'col2', 'col3']
else:
    columns = [f'col_{i+1}' for i in range(num_cols)]
```

## μ‚¬μ© μμ‹

### μ§λ¬Έ μμ‹

- "κ° μΉ΄ν…κ³ λ¦¬λ³„ μν™” μλ¥Ό μ•λ ¤μ£Όμ„Έμ”"
- "κ³ κ°λ³„ μ΄ κ²°μ  κΈμ•΅ μƒμ„ 10λ…μ„ λ³΄μ—¬μ£Όμ„Έμ”"
- "κ°€μ¥ λ§μ΄ λ€μ—¬λ μν™” 5κ°λ”?"
- "μ›”λ³„ λ§¤μ¶ μ¶”μ΄λ¥Ό λ³΄μ—¬μ£Όμ„Έμ”"

### μƒμ„±λλ” νμΌ

```
infographics/
β”β”€β”€ chart_20241014_143022.html    # λ§‰λ€ μ°¨νΈ
β”β”€β”€ pie_20241014_143155.html       # νμ΄ μ°¨νΈ
β””β”€β”€ table_20241014_143301.html     # ν…μ΄λΈ”
```

## μ¥μ 

1. **μ‚¬μ©μ μΉν™”μ **: μμ—°μ–΄λ΅ λ°μ΄ν„°λ² μ΄μ¤ μ§μ κ°€λ¥
2. **μλ™ μ‹κ°ν™”**: λ°μ΄ν„° νƒ€μ…μ— λ§λ” μ°¨νΈ μλ™ μ„ νƒ
3. **μΈν„°λ™ν‹°λΈ**: Plotly κΈ°λ°μ λ™μ  μ°¨νΈ
4. **μ‹¤μ©μ **: μ‹¤μ  DB ν™κ²½μ Decimal λ“± κ³ λ ¤
5. **ν™•μ¥ κ°€λ¥**: μƒλ΅μ΄ μ°¨νΈ νƒ€μ… μ‰½κ² μ¶”κ°€ κ°€λ¥

## ν™μ© λ¶„μ•Ό

- **λΉ„μ¦λ‹μ¤ μΈν…”λ¦¬μ „μ¤**: λΉ„κ°λ°μλ„ μ‰¬μ΄ λ°μ΄ν„° νƒμƒ‰
- **λ°μ΄ν„° λ¶„μ„**: λΉ λ¥Έ μ‹κ°ν™”λ¥Ό ν†µν• μΈμ‚¬μ΄νΈ λ°κ²¬
- **λ¦¬ν¬ν…**: μλ™ν™”λ μ°¨νΈ μƒμ„±
- **κµμ΅**: SQL ν•™μµ λ„κµ¬λ΅ ν™μ©

## κΈ°μ μ  κ³ λ ¤μ‚¬ν•­

### λ³µμ΅ν• λ¶€λ¶„

1. **SQL μΏΌλ¦¬ μ¶”μ¶**: Agent μ¶λ ¥μ—μ„ μ •κ·μ‹μΌλ΅ μΏΌλ¦¬ νμ‹±
2. **λ°μ΄ν„° λ³€ν™**: λ‹¤μ–‘ν• ν•νƒλ¥Ό DataFrameμΌλ΅ μ•μ „ν•κ² λ³€ν™
3. **Decimal μ²λ¦¬**: MySQL νΉν™”λ λ°μ΄ν„° νƒ€μ… μ²λ¦¬

### κ°μ„  κ°€λ¥ν• λ¶€λ¶„

- λ” λ‹¤μ–‘ν• μ°¨νΈ νƒ€μ… μ§€μ›
- μ°¨νΈ μ¤νƒ€μΌ μ»¤μ¤ν„°λ§μ΄μ§•
- μ—λ¬ μ²λ¦¬ κ°•ν™”
- μΊμ‹± μ‹μ¤ν… μ¶”κ°€
